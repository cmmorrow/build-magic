
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.1.2">
    
    
      
        <title>Core Concepts - build-magic</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f955dcd.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="light-blue">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-concepts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="build-magic" class="md-header__button md-logo" aria-label="build-magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            build-magic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core Concepts
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="build-magic" class="md-nav__button md-logo" aria-label="build-magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    build-magic
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        What's New
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Core Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Core Concepts
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directives" class="md-nav__link">
    Directives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-runners" class="md-nav__link">
    Command Runners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-formats" class="md-nav__link">
    Output Formats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directory" class="md-nav__link">
    Working Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stages" class="md-nav__link">
    Stages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config-file" class="md-nav__link">
    Config File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targets" class="md-nav__link">
    Targets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../basic_usage/" class="md-nav__link">
        Using Build-magic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cli_usage/" class="md-nav__link">
        Using the CLI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../config_usage/" class="md-nav__link">
        Defining Config Files
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      <label class="md-nav__link" for="__nav_4_5">
        Using Command Runners
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Using Command Runners" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Using Command Runners
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../runners/local_usage/" class="md-nav__link">
        Using the Local Runner
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../runners/docker_usage/" class="md-nav__link">
        Using the Docker Runner
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../runners/vagrant_usage/" class="md-nav__link">
        Using the Vagrant Runner
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../runners/remote_usage/" class="md-nav__link">
        Using the Remote Runner
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../comparison/" class="md-nav__link">
        Comparison with Similar Tools
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directives" class="md-nav__link">
    Directives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-runners" class="md-nav__link">
    Command Runners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-formats" class="md-nav__link">
    Output Formats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directory" class="md-nav__link">
    Working Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stages" class="md-nav__link">
    Stages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config-file" class="md-nav__link">
    Config File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targets" class="md-nav__link">
    Targets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h1>
<p>To get the most out of build-magic, you should become familiar with build-magic's core concepts:</p>
<ul>
<li><a href="./#commands">Commands</a></li>
<li><a href="./#directives">Directives</a></li>
<li><a href="./#command-runners">Command Runners</a></li>
<li><a href="./#output-formats">Output Formats</a></li>
<li><a href="./#working-directory">Working Directory</a></li>
<li><a href="./#stages">Stages</a></li>
<li><a href="./#config-file">Config File</a></li>
<li><a href="./#targets">Targets</a></li>
<li><a href="./#variables">Variables</a></li>
<li><a href="./#job">Job</a></li>
<li><a href="./#actions">Actions</a></li>
<li><a href="./#parameters">Parameters</a></li>
</ul>
<p>Many of these terms will look familiar if you've used Ansible, Jenkins or GitHub Actions, but the meaning of these terms can be quite different for build-magic.</p>
<h2 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">&para;</a></h2>
<p>Build-magic's primary focus is executing Commands. A Command is a valid command-line interface command that can be executed in a single line. Commands are executed by build-magic using the default shell of the machine the Command is executing on. Each Command that build-magic executes returns stdout, stderr, and an exit code. If a Command returns an exit code other than 0, build-magic will by default stop execution and display any error message from stderr.</p>
<p>There are two ways to execute Commands with build-magic. The simplest way is to execute a single command as an argument to the <code>build-magic</code> command:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic make clean
</code></pre></div>
<p>In this case, build-magic simply executes the <code>make clean</code> Command in the current directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using a command that has multiple arguments or makes use of shell operators such as redirection <code>&gt;</code> or piping <code>|</code>, It will be necessary to wrap the command in single quotes so that the shell doesn't try to interpret the operator.</p>
</div>
<p>Build-magic can also execute multiple commands with the <strong>--command</strong> option in the order they are provided:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic <span class="se">\</span>
--command execute <span class="s1">&#39;tar -czf myfiles.tar.gz file1.txt file2.txt&#39;</span> <span class="se">\</span>
--command execute <span class="s1">&#39;rm file1.txt file2.txt&#39;</span>
</code></pre></div>
<p>Note that the word "execute" is used before the commands. This is a Directive and is described below. Each command is also surrounded in quotes, otherwise build-magic gets confused and thinks you are trying to pass additional arguments.</p>
<p>The build-magic Config File syntax is similar but does not require quotes around the command:</p>
<div class="highlight"><pre><span></span><code><span class="nt">commands</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">execute</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tar -czf myfiles.tar.gz file1.txt file2.txt</span>
  <span class="p p-Indicator">-</span> <span class="nt">execute</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rm file1.txt file2.txt</span>
</code></pre></div>
<h2 id="directives">Directives<a class="headerlink" href="#directives" title="Permanent link">&para;</a></h2>
<p>Directives describe the type of Command being executed. All Commands that build-magic executes must have a Directive associated with them. Directives don't impart any special meaning to build-magic and are simply used to describe the command. Valid Directives that build-magic understands are:</p>
<ul>
<li><em>execute</em></li>
<li><em>build</em></li>
<li><em>test</em></li>
<li><em>install</em></li>
<li><em>release</em></li>
<li><em>deploy</em></li>
</ul>
<p>If only a single command is passed to build-magic on the command-line without a Directive, the <em>execute</em> Directive is used by default.</p>
<h2 id="command-runners">Command Runners<a class="headerlink" href="#command-runners" title="Permanent link">&para;</a></h2>
<p>Build-magic can execute Commands on the local machine, in a container, in a virtual machine, or on a remote machine. You tell build-magic how you want to execute the Commands by specify a Command Runner with the <strong>--runner</strong> option. Valid Command Runners are:</p>
<ul>
<li><em>local</em></li>
<li><em>docker</em></li>
<li><em>vagrant</em></li>
<li><em>remote</em></li>
</ul>
<p>By default, the <em>local</em> Command Runner is used if the <strong>--runner</strong> option isn't provided.</p>
<p>All Command Runners except for the <em>local</em> Command Runner must also provide the <code>--environment</code> option. The environment depends on the Command Runner being used:</p>
<ul>
<li><em>docker</em>: The name of the Docker container - <code>ubuntu:latest</code></li>
<li><em>vagrant</em>: The path to the Vagrantfile - <code>./Vagrantfile</code></li>
<li><em>remote</em>: The username and hostname of the remote machine to connect to - <code>user@myhost</code></li>
</ul>
<p>Example:</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Command-line</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>&gt; build-magic --runner docker --environment ubuntu:latest make
</code></pre></div>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">Config File</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nt">build-magic</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">stage</span><span class="p">:</span>
    <span class="nt">runner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
    <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu:latest</span>
    <span class="nt">commands</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">execute</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">make</span>
</code></pre></div>
</div>
</div>
<h2 id="output-formats">Output Formats<a class="headerlink" href="#output-formats" title="Permanent link">&para;</a></h2>
<p>Build-magic reports it's progress and status to stdout on a terminal. There are three different output format based on your preference and use case:</p>
<ul>
<li><em>fancy</em>: Nicely formatted text output</li>
<li><em>plain</em>: Log friendly text output</li>
<li><em>quiet</em>: No output</li>
</ul>
<p>The default Output Format is <em>fancy</em> which is useful when using build-magic from a TTY (terminal) application. The <em>plain</em> Output Format is useful if build-magic is being used from a CI/CD tool or piped to a log file where a log-like output is preferred.</p>
<p>Output Formats can only be set as a command-line option.</p>
<h2 id="working-directory">Working Directory<a class="headerlink" href="#working-directory" title="Permanent link">&para;</a></h2>
<p>The Working Directory is the path that build-magic operates from. Non-absolute paths in commands that build-magic executes are relative to the Working Directory. The default Working Directory is the current directory. The Working Directory can be set from the command-line with the <code>--wd /home/user</code> command or in a build-magic Config File with <code>working directory: /home/user</code>.</p>
<h2 id="stages">Stages<a class="headerlink" href="#stages" title="Permanent link">&para;</a></h2>
<p>A Stage is a collection of Commands. When you use build-magic from the command-line, all the Commands are gathered into a single stage and executed as a single collection. Build-magic can execute multiple Stages, but only by using a Config File.</p>
<h2 id="config-file">Config File<a class="headerlink" href="#config-file" title="Permanent link">&para;</a></h2>
<p>A build-magic Config File is a YAML file that describes the Stages and Commands to run, and how to run them. The Config File consists of a list of Stages to be executed in order. Multiple Config Files can be provided, in which case the Stages are executed in the order they are provided in each Config File. Specific stages to execute can be selected from the command line using Targets which are described below.</p>
<h2 id="targets">Targets<a class="headerlink" href="#targets" title="Permanent link">&para;</a></h2>
<p>A Target is a Stage name that can be used to run the corresponding Stage regardless of the Stage order in a Config file. Multiple Targets can be specified to reorder Stages at runtime. Targets can be used to filter the Stages to execute. For example, assume you have the Config File below named <em>build-magic.yaml</em>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">build-magic</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">stage</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">unittests</span>
      <span class="nt">commands</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">test</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pytest</span>
  <span class="p p-Indicator">-</span> <span class="nt">stage</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">documentation</span>
      <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cleanup</span>
      <span class="nt">commands</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mkdocs build</span>
        <span class="p p-Indicator">-</span> <span class="nt">deploy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mkdocs gh-deploy</span>
  <span class="p p-Indicator">-</span> <span class="nt">stage</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">package</span>
      <span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cleanup</span>
      <span class="nt">commands</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python setup.py sdist bdist_wheel --universal</span>
        <span class="p p-Indicator">-</span> <span class="nt">release</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">twine upload dist/*</span>
</code></pre></div>
<p>To only run the <em>unittests</em> stage in this Config File, use the below command:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic -t unittests
</code></pre></div>
<p>or if the stage name is a single word, the command can be shortened to:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic unittests
</code></pre></div>
<p>To run just the <em>unittests</em> and <em>documentation</em> stages, use:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic -t unittests -t documentation
</code></pre></div>
<p>or:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic unittests documentation
</code></pre></div>
<p>To swap the order of the <em>documentation</em> and <em>package</em> stages, use:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic unittests package documentation
</code></pre></div>
<p>All stages in the Config File can be run with:</p>
<div class="highlight"><pre><span></span><code>build-magic all
</code></pre></div>
<h2 id="variables">Variables<a class="headerlink" href="#variables" title="Permanent link">&para;</a></h2>
<p>Variables are values that are substituted for placeholders in a Config File. Variables values and the corresponding placeholder name are specified at runtime as command-line arguments. The placeholders use a Jinja-like syntax of surrounding the placeholder name in <code>{{  }}</code>. The following Config File container placeholders intended for Variable substitution:</p>
<div class="highlight"><pre><span></span><code><span class="nt">build-magic</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">stage</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">package</span>
      <span class="nt">runner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
      <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu:latest</span>
      <span class="nt">commands</span><span class="p">:</span>
        <span class="c1"># Build the package</span>
        <span class="p p-Indicator">-</span> <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpmbuild -bb $HOME/rpmbuild/SPECS/app{{ version }}.spec</span>
        <span class="c1"># Install and test the package</span>
        <span class="p p-Indicator">-</span> <span class="nt">install</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dnf install -y $HOME/rpmbuild/RPMS/noarch/app{{ version }}.rpm</span>
        <span class="c1"># Upload the package</span>
        <span class="p p-Indicator">-</span> <span class="nt">release</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scp app{{ version }}.rpm {{ user }}:{{ password }}@{{ host }}</span>
</code></pre></div>
<p>This Config File can be re-used by different users to release new versions of the <strong>app</strong> RPM package. The Variables can be assigned at runtime with the following command as an example:</p>
<div class="highlight"><pre><span></span><code>&gt; build-magic -t package <span class="se">\</span>
  --variable version <span class="m">3</span>.14.15 <span class="se">\</span>
  --variable host myserver <span class="se">\</span>
  --variable user myuser <span class="se">\</span>
  --prompt password
</code></pre></div>
<p>The <strong>--variable</strong> option consists of the placeholder name followed by the value. The <strong>--prompt</strong> option will interactively prompt the user for input. This is the recommended way for providing secrets that shouldn't appear in the shell history.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>--prompt</strong> option only works when using a TTY (terminal) interactively and will cause build-magic to hang if executed from a script.</p>
</div>
<h2 id="job">Job<a class="headerlink" href="#job" title="Permanent link">&para;</a></h2>
<p>A Job is a collection of all the Stages that build-magic is going to execute. If more than one Config File is provided, the Job consists of every Stage from each Config File.</p>
<h2 id="actions">Actions<a class="headerlink" href="#actions" title="Permanent link">&para;</a></h2>
<p>Actions can be used to modify build-magic's default behavior by adding setup and teardown behavior to a Stage. Build-magic's Actions are:</p>
<ul>
<li>default: Start up and destroy the virtual machine or container when the docker or vagrant Command Runner is used by the Stage. No setup or teardown is performed for the local or remote Command Runners.</li>
<li>persist: Don't destroy the virtual machine or container used by the Stage. Useful for debugging.</li>
<li>cleanup: Delete any files created by a Stage.</li>
</ul>
<h2 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h2>
<p>Parameters are optional configurations that are specific to a particular Command Runner.</p>
<table>
<thead>
<tr>
<th>Command Runner</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>remote</td>
<td>keytype</td>
<td>The SSH key type (dsa, rsa, ecdsa, ed25519)</td>
</tr>
<tr>
<td>remote</td>
<td>keypath</td>
<td>The path to the SSH private key</td>
</tr>
<tr>
<td>remote</td>
<td>keypass</td>
<td>The private key passphrase if set</td>
</tr>
<tr>
<td>vagrant</td>
<td>hostwd</td>
<td>The working directory of the host (local machine)</td>
</tr>
<tr>
<td>vagrant</td>
<td>bind</td>
<td>The vm directory that is bound to the host</td>
</tr>
<tr>
<td>docker</td>
<td>hostwd</td>
<td>The working directory of the host (local machine)</td>
</tr>
<tr>
<td>docker</td>
<td>bind</td>
<td>A bind path on the container to the hostwd</td>
</tr>
</tbody>
</table>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../../getting_started/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Getting Started
            </div>
          </div>
        </a>
      
      
        <a href="../basic_usage/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Using Build-magic
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>